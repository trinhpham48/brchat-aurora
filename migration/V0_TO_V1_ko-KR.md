# 마이그레이션 가이드 (v0에서 v1로)

이전 버전(~`0.4.x`)의 Bedrock Chat을 사용하고 계신 경우, 아래의 단계들을 따라 마이그레이션을 진행하셔야 합니다.

## 왜 이렇게 해야 하나요?

이 주요 업데이트에는 중요한 보안 업데이트가 포함되어 있습니다.

- 벡터 데이터베이스(즉, Aurora PostgreSQL의 pgvector)의 저장소가 이제 암호화되어, 배포 시 교체가 발생합니다. 이는 기존의 벡터 항목들이 삭제된다는 것을 의미합니다.
- 봇을 생성할 수 있는 사용자를 제한하기 위해 `CreatingBotAllowed` Cognito 사용자 그룹을 도입했습니다. 현재 기존 사용자들은 이 그룹에 속해있지 않으므로, 봇 생성 기능을 부여하고 싶다면 수동으로 권한을 부여해야 합니다. 참고: [Bot Personalization](../../README.md#bot-personalization)

## 전제 조건

[데이터베이스 마이그레이션 가이드](./DATABASE_MIGRATION_ko-KR.md)를 읽고 항목 복원 방법을 결정하십시오.

## 단계

### 벡터 스토어 마이그레이션

- 터미널을 열고 프로젝트 디렉토리로 이동하세요
- 배포하고자 하는 브랜치를 가져옵니다. 다음은 원하는 브랜치(이 경우 `v1`)로 이동하여 최신 변경사항을 가져오는 방법입니다:

```sh
git fetch
git checkout v1
git pull origin v1
```

- DMS를 사용하여 항목을 복원하려는 경우, 비밀번호 순환을 비활성화하고 데이터베이스 접근 비밀번호를 기록하는 것을 잊지 마세요. 마이그레이션 스크립트([migrate_v0_v1.py](./migrate_v0_v1.py))로 복원하는 경우에는 비밀번호를 기록할 필요가 없습니다.
- CloudFormation이 기존 Aurora 클러스터를 제거할 수 있도록 모든 [게시된 API](../PUBLISH_API_ko-KR.md)를 제거하세요.
- [npx cdk deploy](../README.md#deploy-using-cdk)를 실행하면 Aurora 클러스터 교체가 트리거되고 모든 벡터 항목이 삭제됩니다.
- 벡터 항목을 복원하려면 [데이터베이스 마이그레이션 가이드](./DATABASE_MIGRATION_ko-KR.md)를 따르세요.
- 사용자가 지식을 보유한 기존 봇(예: RAG 봇)을 사용할 수 있는지 확인하세요.

### CreatingBotAllowed 권한 부여

- 배포 후에는 모든 사용자가 새로운 봇을 생성할 수 없게 됩니다.
- 특정 사용자가 봇을 생성할 수 있도록 하려면, 관리 콘솔이나 CLI를 사용하여 해당 사용자를 `CreatingBotAllowed` 그룹에 추가하세요.
- 사용자가 봇을 생성할 수 있는지 확인하세요. 사용자는 재로그인이 필요하다는 점에 유의하세요.