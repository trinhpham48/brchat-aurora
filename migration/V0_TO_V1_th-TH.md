# คู่มือการย้าย (v0 ไป v1)

หากคุณใช้ Bedrock Chat เวอร์ชันก่อนหน้านี้อยู่แล้ว (~`0.4.x`) คุณจำเป็นต้องทำตามขั้นตอนด้านล่างเพื่อย้ายไปยังเวอร์ชันใหม่

## ทำไมฉันจึงต้องทำสิ่งนี้?

การอัปเดตครั้งใหญ่นี้มีการอัปเดตด้านความปลอดภัยที่สำคัญ

- ฐานข้อมูลเวกเตอร์ (นั่นคือ pgvector บน Aurora PostgreSQL) มีการเข้ารหัสการจัดเก็บข้อมูลแล้ว ซึ่งจะทำให้เกิดการแทนที่เมื่อทำการติดตั้ง นั่นหมายความว่ารายการเวกเตอร์ที่มีอยู่จะถูกลบ
- เราได้เพิ่มกลุ่มผู้ใช้ Cognito `CreatingBotAllowed` เพื่อจำกัดผู้ใช้ที่สามารถสร้างบอทได้ ผู้ใช้ที่มีอยู่ในปัจจุบันไม่ได้อยู่ในกลุ่มนี้ ดังนั้นคุณจำเป็นต้องเพิ่มสิทธิ์การใช้งานด้วยตนเองหากคุณต้องการให้พวกเขามีความสามารถในการสร้างบอท ดูเพิ่มเติมที่: [Bot Personalization](../../README.md#bot-personalization)

## ข้อกำหนดเบื้องต้น

อ่าน [Database Migration Guide](./DATABASE_MIGRATION_th-TH.md) และพิจารณาวิธีการในการกู้คืนรายการต่างๆ

## ขั้นตอน

### การย้ายข้อมูล Vector store

- เปิด terminal และไปที่ไดเรกทอรีของโปรเจค
- ดึงข้อมูลจาก branch ที่คุณต้องการ deploy ต่อไปนี้คือการสลับไปยัง branch ที่ต้องการ (ในกรณีนี้คือ `v1`) และดึงการเปลี่ยนแปลงล่าสุด:

```sh
git fetch
git checkout v1
git pull origin v1
```

- หากคุณต้องการกู้คืนรายการด้วย DMS อย่าลืมปิดการหมุนเวียนรหัสผ่านและจดรหัสผ่านเพื่อเข้าถึงฐานข้อมูล หากกู้คืนด้วยสคริปต์การย้ายข้อมูล([migrate_v0_v1.py](./migrate_v0_v1.py)) คุณไม่จำเป็นต้องจดรหัสผ่าน
- ลบ [published APIs](../PUBLISH_API_th-TH.md) ทั้งหมดเพื่อให้ CloudFormation สามารถลบคลัสเตอร์ Aurora ที่มีอยู่ได้
- รัน [npx cdk deploy](../README.md#deploy-using-cdk) เพื่อทริกเกอร์การแทนที่คลัสเตอร์ Aurora และลบรายการ vector ทั้งหมด
- ทำตาม [คู่มือการย้ายฐานข้อมูล](./DATABASE_MIGRATION_th-TH.md) เพื่อกู้คืนรายการ vector
- ตรวจสอบว่าผู้ใช้สามารถใช้บอทที่มีอยู่ซึ่งมีความรู้ เช่น บอท RAG ได้

### เพิ่มสิทธิ์ CreatingBotAllowed

- หลังจาก deploy ผู้ใช้ทั้งหมดจะไม่สามารถสร้างบอทใหม่ได้
- หากคุณต้องการให้ผู้ใช้เฉพาะสามารถสร้างบอทได้ ให้เพิ่มผู้ใช้เหล่านั้นเข้าไปในกลุ่ม `CreatingBotAllowed` โดยใช้คอนโซลการจัดการหรือ CLI
- ตรวจสอบว่าผู้ใช้สามารถสร้างบอทได้หรือไม่ โปรดทราบว่าผู้ใช้จำเป็นต้องเข้าสู่ระบบใหม่